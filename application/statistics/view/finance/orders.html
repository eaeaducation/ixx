{extend name='admin@public/content'}
{block name="button"}
{/block}

{block name="content"}
<style>
    .new-table td {
        border:1px solid #e2e2e2;
    }
</style>

<div class="layui-form layui-form-pane form-search" style="height: 60px;">
    <div class="row" style="margin-left:0.4%;float: left">
        <div class="layui-form-item layui-inline">
            <label class="layui-form-label">时间</label>
            <div class="layui-input-inline">
                <input type="text" id="time_range" name="time_range" value="{$Think.get.time_range|default=date('Y')}"
                       placeholder="选择时间" class="input-sm form-control">
            </div>
        </div>
        <div class="layui-form-item layui-inline">
            <button class="layui-btn layui-btn-primary" id="search"><i class="layui-icon">&#xe615;</i> 搜 索</button>
        </div>
    </div>
</div>
<script>
    window.form.render();
</script>
<div id="container1" style="min-width:400px;height:400px;"></div>

<div id="container2" style="min-width:400px;height:400px;"></div>

<script>

    $(function () {
        layui.use('laydate', function () {
            var laydate = layui.laydate
            laydate.render({
                elem: '#time_range',
                theme: '#0099CC',
                format: 'yyyy',
                type: 'year',
                done: function (value, date, endDate) {
                    var date = new Date(date.year + '-' + date.month + '-' + date.date)
                    var endDate = new Date(endDate.year + '-' + endDate.month + '-' + endDate.date)
                    // if ((endDate - date) / 1000 / 86400 > 31) {
                    //     $.msg.alert('最大时间范围为31天', function () {
                    //         $('#time_range').val('')
                    //     })
                    // }
                }
            })
        })
        data_onload()
        $('#search').click(function () {
            var date = $('#time_range').val();
            data_onload(date);
        })
        function data_onload(date = '') {
            $.post('/statistics/finance/orders_data', {date: date}, function (res) {
                console.log(res)
                require(['echarts'], function () {
                    var echarts = require('echarts');
                    var myChart1 = echarts.init(document.getElementById('container1'));
                    var myChart2 = echarts.init(document.getElementById('container2'));
                    option1 = {
                        title: {
                            text: res.year+'校区年度订单成交量',
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'cross',
                                crossStyle: {
                                    color: '#999'
                                }
                            }
                        },
                        toolbox: {
                            feature: {
                                dataView: {show: true, readOnly: false},
                                magicType: {show: true, type: ['line']},
                                restore: {show: true},
                                saveAsImage: {show: true}
                            }
                        },
                        legend: {
                            data: ['销售量'],
                            left: 'left'
                        },
                        xAxis: [
                            {
                                type: 'category',
                                data: res.branchs,
                                axisPointer: {
                                    type: 'shadow'
                                },
                                axisLabel: {
                                    interval:0,
                                    rotate:40
                                },
                            }
                        ],
                        yAxis: [
                            {
                                type: 'value',
                                name: '销售量',
                                min: 0,
                                // max: 250,
                                axisLabel: {
                                    formatter: '{value} '
                                }
                            }
                        ],
                        series: [
                            {
                                name: '销售量',
                                type: 'bar',
                                data: res.deal_num,
                                color: ['#5793f3']
                            },
                        ]
                    };
                    option2 = {
                        title: {
                            text: res.year+'校区年度订单销售额',
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'cross',
                                crossStyle: {
                                    color: '#999'
                                }
                            }
                        },
                        toolbox: {
                            feature: {
                                dataView: {show: true, readOnly: false},
                                magicType: {show: true, type: ['bar']},
                                restore: {show: true},
                                saveAsImage: {show: true}
                            }
                        },
                        legend: {
                            data: ['销售额'],
                            left: 'left'
                        },
                        xAxis: [
                            {
                                type: 'category',
                                data: res.branchs,
                                axisPointer: {
                                    type: 'shadow'
                                },
                                axisLabel: {
                                    interval:0,
                                    rotate:40
                                },
                            }
                        ],
                        yAxis: [
                            {
                                type: 'value',
                                name: '销售额',
                                min: 0,
                                axisLabel: {
                                    formatter: '{value} '
                                }
                            }
                        ],
                        series: [
                            {
                                name: '销售额',
                                type: 'bar',
                                data: res.deal_price,
                                color: ['#d14a61'],
                            },
                        ]
                    };
                    myChart1.setOption(option1);
                    myChart2.setOption(option2);
                })
            })
        }

    })

</script>
{/block}
