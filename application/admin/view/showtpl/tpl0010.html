<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EA九宫格抽奖</title>
    <link href="/static/temp/tpl0010/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/temp/tpl0010/css/swiper.min.css" rel="stylesheet">
    <link href="/static/temp/tpl0010/css/common.css" rel="stylesheet">
    <link href="/static/temp/tpl0010/css/index.css" rel="stylesheet">
    <script src="/static/extend_res/jquery/jquery-3.3.1.js"></script>
    <script src="/static/temp/tpl0010/js/jQueryRotate.2.2.js"></script>
    <script src="/static/temp/tpl0010/js/jquery.easing.min.js"></script>
    <!--<script src="/static/temp/tpl0010/js/common.js"></script>-->
    <!--form 表单样式-->
    <link rel="stylesheet" href="/static/plugs/layui/css/layui.css">
    <link rel="stylesheet" href="/static/temp/tpl0010/css/invite.css">
</head>
<body>

<div class="kljgg"><img src="/static/temp/tpl0010/images/kljgg.png" class="img-responsive"><a href="javascript:void(0);" class="rolebtn showrolebox">活动规则</a></div>
<div class="jggbox">
    <div class="clearfix"><img src="/static/temp/tpl0010/images/jgg.png" class="img-responsive"></div>
    <div class="cont" id="lottery">
        <table width="100%" height="100%">
            <tr>
                <td height="33%" width="33%" class="lottery-unit lottery-unit-0 active"><div class="prv">
                    <img id="img0" class="img-responsive"><div class="toum"></div></div></td>
                <td class="lottery-unit lottery-unit-1"><div class="prv">
                    <img id="img1" class="img-responsive"><div class="toum"></div></div></td>
                <td class="lottery-unit lottery-unit-2"><div class="prv">
                    <img id="img2" class="img-responsive"><div class="toum"></div></div></td>
            </tr>
            <tr>
                <td height="33%" width="33%" class="lottery-unit lottery-unit-7"><div class="prv">
                    <img id="img3" class="img-responsive"><div class="toum"></div></div></td>
                <td><a href="javascript:void(0);" id="start">
                    <img id="imggo" class="img-responsive"></a></td>
                <td class="lottery-unit lottery-unit-3"><div class="prv">
                    <img id="img5" class="img-responsive"><div class="toum"></div></div></td>
            </tr>
            <tr>
                <td height="33%" width="33%" class="lottery-unit lottery-unit-6"><div class="prv">
                    <img id="img6" class="img-responsive"><div class="toum"></div></div></td>
                <td class="lottery-unit lottery-unit-5"><div class="prv">
                    <img id="img7" class="img-responsive"><div class="toum"></div></div></td>
                <td class="lottery-unit lottery-unit-4"><div class="prv">
                    <img id="img8" class="img-responsive"><div class="toum"></div></div></td>
            </tr>
        </table>
    </div>
</div>
<div class="clearfix text-center wihte f-sm">
    <p class="mar-v-xs">开始时间：2018/01/01</p>
    <p class="mar-v-xs">结束时间：2018/12/12</p>
</div>
<div class="cover"></div>
<div class="rolebox">
    <div class="title">活动规则<a href="javascript:void(0);" class="icon closerolebox icon-close"></a></div>
    <div class="cont">
        <p>1、每人有三次机会，红包金额随机（0-300元）红包金额大小看你人品；</p>
        <p>2、分享给好友，每多一位好友参加，就多一次抽奖机会，邀请越多，机会越多；</p>
        <p>3、10元即可提现（每天0-8点由于官方限制不能提现，提现后会通过服务通知发到您的微信，注意查收噢；不要删掉了）</p>
        <a href="javascript:void(0);" class="btns closerolebox">我知道了</a>
    </div>
</div>
<div class="giftbg"><img src="/static/temp/tpl0010/images/giftbg.png" class="img-responsive"></div>
<div class="giftout">
    <div class="text-center org pad-v f-md"><span id="giftname"></span></div>
    <div class="clearfix">
        <div class="pad-h"><img src="/static/temp/tpl0010/images/0.png" id="giftimg" class="img-responsive"></div>
    </div>
    <div class="clearfix giftfm hidden">
        <div class="clearfix text-center mar-v-sm f-sm wihte pad-h-sm">记得留下您的联系方式，我们会尽快和您确认把奖品快递给您噢（瞄币和现金将会自动归入账户）</div>

        <div class="form clearfix">
            <div class="form-item">
                <input type="number" placeholder="请输入手机号码" name="mobile">
            </div>
            <div class="form-item">
                <input type="password" placeholder="请输入密码 8-16位数字和字母组合" name="password">
            </div>
            <div class="form-item code" style="display: none;" id="code">
                <input type="number" placeholder="请输入验证码" name="code">
                <span class="sendCode">获取验证码</span>
            </div>
            <div class="form-item captcha" id="captcha">
                <div class="l-captcha" data-site-key="03406796f05aa51f6713236cdf521767" data-width="100%"
                     data-callback="validate"></div>
            </div>
            <div class="form-item">
                <button type="submit" class="disabled submit">立即领取</button>
                <button type="submit" class="reset">重置验证</button>
            </div>
        </div>
    </div>
    <div class="clearfix mar-v rightnow"><a href="javascript:void(0);" class="btns getgift notread">立即领取</a></div>
</div>
<div class="giftclose"><a href="javascript:void(0);" class="icon closegift icon-close"></a></div>

<script src="//captcha.luosimao.com/static/dist/api.js"></script>
<script src="/static/plugs/jquery/jquery.min.js"></script>
<script src="/static/plugs/layui/layui.all.js"></script>
<script src="/static/temp/tpl0010/js/invite.js"></script>
<script>
    $(function () {
        //使用getJSON方法读取json数据,
        //注意：info.json可以是不同类型文件，只要其中的数据为json类型即可
        {if isset($myid)}
        var page = window.parent.getnum();
        $("[aria-label='Go to slide " + page + "']").click();
        var url = "{:url('showtpl/get_json_res')}?myid={$myid}";
        {elseif isset($actid) }
        var url = "{:url('showtpl/get_json_release')}?actid={$actid}";
        {else /}
        var url = "{:url('showtpl/get_json_res_tplmgmt')}?tplid={$tplid}";
        {/if}
        $.getJSON(url, function (data) {
            //给所有页面设置logo
            console.log(data.data[4].background.value);
            $("#img0").attr('src', data.data[0].background.value);
            $("#img1").attr('src', data.data[1].background.value);
            $("#img2").attr('src', data.data[2].background.value);
            $("#img3").attr('src', data.data[3].background.value);
            $("#imggo").attr('src', data.logo);
            $("#img5").attr('src', data.data[5].background.value);
            $("#img6").attr('src', data.data[6].background.value);
            $("#img7").attr('src', data.data[7].background.value);
            $("#img8").attr('src', data.data[4].background.value);
        });




        // 以下为九宫格抽奖代码
        var lottery={
            index:0,	//当前转动到哪个位置
            count:9,	//总共有多少个位置
            timer:0,	//setTimeout的ID，用clearTimeout清除
            speed:200,	//初始转动速度
            times:0,	//转动次数
            cycle:21,	//转动基本次数：即至少需要转动多少次再进入抽奖环节
            prize:4,	//中奖位置
            init:function(id){
                if ($("#"+id).find(".lottery-unit").length>0) {
                    $lottery = $("#"+id);
                    $units = $lottery.find(".lottery-unit");
                    this.obj = $lottery;
                    this.count = $units.length;
                    $lottery.find(".lottery-unit-"+this.index).addClass("active");
                };
            },
            roll:function(){
                var index = this.index;
                var count = this.count;
                var lottery = this.obj;
                $(lottery).find(".lottery-unit-"+index).removeClass("active");
                index += 1;
                if (index>count){
                    index = 0;
                };
                $(lottery).find(".lottery-unit-"+index).addClass("active");
                this.index=index;
                return false;
            },
            stop:function(index){
                this.prize=index;
                return false;
            }
        };

        function roll(){
            lottery.times += 1;
            lottery.roll();
            if (lottery.times > lottery.cycle+10 && lottery.prize==lottery.index) {
                $('#giftname').html(p);
                $('#giftimg').attr('src',n);
                showgiftbox();
                //alert(lottery.prize+' / '+lottery.index);
                clearTimeout(lottery.timer);
                //lottery.prize=4;
                lottery.times=0;
                click=false;
            }else{
                if (lottery.times<lottery.cycle) {
                    lottery.speed -= 10;
                }else if(lottery.times==lottery.cycle) {
                    //var index = Math.random()*(lottery.count)|0;
                    //lottery.prize = index;
                }else{
                    if (lottery.times > lottery.cycle+10 && ((lottery.prize==0 && lottery.index==7) || lottery.prize==lottery.index+1)) {
                        lottery.speed += 110;
                    }else{
                        lottery.speed += 20;
                    }
                }
                if (lottery.speed<40) {
                    lottery.speed=40;
                };
                //console.log(lottery.times+'^^^^^^'+lottery.speed+'^^^^^^^'+lottery.prize);
                lottery.timer = setTimeout(roll,lottery.speed);
            }
            return false;
        }
        var click = false;
        var n = 8;
        var p = '';


        $('#start').click(function(){
            if(click){ return false; }
            $.getJSON(url, function (data) {
                //给所有页面设置logo
                var res = data.data;
                var lastres = prizeRand(res);

                function prizeRand(oArr) {
                    var sum = 0;    // 总和
                    var rand = 0;   // 每次循环产生的随机数
                    var result = 0; // 返回的对象的key

                    for (var i in oArr) {
                        sum += eval(oArr[i].probaility.value);
                    }
                    // 思路就是如果设置的数落在随机数内，则返回，否则减去本次的数
                    for (var i in oArr) {
                        rand = Math.floor(Math.random()*sum + 1);
                        if (eval(oArr[i].probaility.value) >= rand) {
                            result = i;
                            break;
                        } else {
                            sum -= eval(oArr[i].probaility.value);
                        }
                    }
                    return result;
                }
                var s = '';
                if (lastres == 3){
                    s = 7;
                }else if(lastres == 5){
                    s = 3;
                }else if(lastres == 7){
                    s = 5;
                }else {
                    s = lastres;
                }
                p = res[lastres].reward.value;
                n = res[lastres].background.value;
                lottery.init('lottery');
                lottery.speed=100;
                lottery.prize=s;
                click=true;
                roll();
            });
        });

        $('.getgift').click(function(){
            if($(this).hasClass('notread')){
                $('.rightnow').hide();
                $(this).removeClass('notread');
                $('.giftfm').removeClass('hidden');
            }else{
                console.log(2);
                hidegiftbox();
            }
        });
        //关闭
        $('.closegift').click(function(){
            $('.rightnow').show();
            hidegiftbox();
        });
        //规则
        $('.showrolebox').click(function(){
            showrolebox();
        });
        $('.closerolebox').click(function(){
            hiderolebox();
        });

        function showgiftbox(){
            $('.giftfm').addClass('hidden');
            $('.getgift').addClass('notread');
            $('.cover').fadeIn(500,function(){
                $('.giftout,.giftbg,.giftclose').show();
            });
        }
        function hidegiftbox(){
            $('.giftout,.giftbg,.giftclose').hide(function(){
                $('.cover').fadeOut();
            });
        }
        function showrolebox(){
            $('.cover').fadeIn();
            $('.rolebox').show();
        }
        function hiderolebox(){
            $('.rolebox').hide(function(){
                $('.cover').fadeOut();
            });
        }


    });
</script>
</body>
</html>